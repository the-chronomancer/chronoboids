<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
		/>
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />

		<meta name="author" content="cubedhuang" />
		<meta name="description" content="2D flocking simulation!" />
		<meta
			name="keywords"
			content="cubedhuang, boids, flocking, 2d, simulation"
		/>
		<meta name="theme-color" content="#2f86c9" />

		<meta property="og:title" content="Boids Simulation" />
		<meta property="description" content="2D flocking simulation!" />
		<meta property="og:description" content="2D flocking simulation!" />
		<meta property="og:url" content="https://boids.dan.onl/" />
		<meta property="og:image" content="https://cubedhuang.com/logo.png" />

		<link rel="shortcut icon" href="https://cubedhuang.com/favicon.ico" />

		<link rel="stylesheet" href="./style.css" />
		<link rel="canonical" href="https://boids.dan.onl/" />
		<link rel="author" href="https://dan.onl/" />
		<link rel="publisher" href="https://dan.onl/" />

		<!-- Cloudflare Web Analytics -->
		<script
			defer
			src="https://static.cloudflareinsights.com/beacon.min.js"
			data-cf-beacon='{"token": "52dcb98c1a10492682592c6cfe35319d"}'
		></script>
		<!-- End Cloudflare Web Analytics -->

		<title>Boids Simulation</title>
	</head>

	<body>
		<div id="container" role="region" aria-label="Simulation Controls">
			<header>
				<h3>boids</h3>
				<a
					href="https://github.com/cubeDhuang/boids"
					class="source"
					target="_blank"
					rel="noopener noreferrer"
				>
					source code
				</a>
			</header>

			<p class="info">
				left and right click to move the boids, or just watch their
				flocking patterns!
				<br />
				double click to make an explosion <br />
				middle click or click in the top right to toggle this menu
				<br />
				press space to pause, and use . to advance one frame
			</p>

			<div id="pauser" role="group" aria-label="Playback controls">
				<input 
					type="checkbox" 
					id="pauseButton" 
					data-model="paused"
					aria-label="Pause simulation"
				/>
				<label for="pauseButton" aria-hidden="true"> </label>
				<button class="nexter" data-click="next" aria-label="Advance one frame">next frame</button>
			</div>

			<div class="resetters" role="group" aria-label="Reset controls">
				<button data-click="restart">restart simulation</button>
				<button data-click="reset">reset settings</button>
			</div>

			<div class="resetters" role="group" aria-label="Settings management">
				<button data-click="exportSave">export settings</button>
				<button data-click="importMenu">import settings</button>
			</div>

			<p id="boids-label">number of boids: <span data-show="boids"></span></p>
			<input
				type="range"
				min="50"
				max="5000"
				step="50"
				data-model="boids"
				aria-labelledby="boids-label"
			/>

			<h4>visual settings</h4>

			<div>
				<input type="checkbox" id="toggle" data-model="toggle" />
				<label for="toggle"> hide menu toggle (still works)</label>
			</div>
			<div>
				<input type="checkbox" id="desired" data-model="desired" />
				<label for="desired"> show boid desired directions</label>
			</div>
			<div>
				<input type="checkbox" id="hideBoids" data-model="hideBoids" />
				<label for="hideBoids"> completely hide boids (for art?)</label>
			</div>
			<div>
				<input type="checkbox" id="hues" data-model="hues" />
				<label for="hues"> change hues to indicate speed</label>
			</div>
			<div>
				<input type="checkbox" id="areas" data-model="areas" />
				<label for="areas"> show vision areas</label>
			</div>
			<div>
				<input type="checkbox" id="outlines" data-model="outlines" />
				<label for="outlines"> show vision outlines</label>
			</div>
			<div>
				<input type="checkbox" id="halfAreas" data-model="halfAreas" />
				<label for="halfAreas">
					halve shown vision area size
					<span class="tooltip" role="tooltip">
						?
						<span class="tip">
							so boids interact when their circles "collide"
							rather than when their circles intersect each
							others' centers
						</span>
					</span>
				</label>
			</div>

			<h4>boid movement</h4>

			<div>
				<input type="checkbox" id="particle" data-model="particle" />
				<label for="particle"> particle mode</label>
			</div>

			<div>
				<input type="checkbox" id="bounce" data-model="bounce" />
				<label for="bounce"> bounce off of edges</label>
			</div>

			<p id="accuracy-label">
				movement accuracy: <span data-show="accuracy"></span>
				<span class="tooltip" role="tooltip">
					?
					<span class="tip">
						the maximum number of boids in vision that each boid
						checks - higher values can cause lag with more boids
					</span>
				</span>
			</p>
			<input
				type="range"
				min="2.25"
				max="10"
				step="0.25"
				data-model="accuracyPower"
				aria-labelledby="accuracy-label"
			/>

			<p id="vision-label">boid vision: <span data-show="vision"></span></p>
			<input
				type="range"
				min="0"
				max="150"
				step="5"
				data-model="vision"
				aria-labelledby="vision-label"
			/>

			<p id="alignment-label">alignment force: <span data-show="alignment"></span></p>
			<input
				type="range"
				min="0"
				max="4"
				step="0.1"
				data-model="alignment"
				aria-labelledby="alignment-label"
			/>

			<p id="bias-label">
				alignment bias: <span data-show="bias"></span>
				<span class="tooltip" role="tooltip">
					?
					<span class="tip">
						how much a boid will align towards other boids. values
						greater than 1 mean that it will be biased towards other
						boids facing the same direction, while values lower than
						1 mean the opposite.
					</span>
				</span>
			</p>
			<input
				type="range"
				min="0.25"
				max="4"
				step="0.05"
				data-model="bias"
				aria-labelledby="bias-label"
			/>

			<p id="cohesion-label">cohesion force: <span data-show="cohesion"></span></p>
			<input
				type="range"
				min="0"
				max="4"
				step="0.1"
				data-model="cohesion"
				aria-labelledby="cohesion-label"
			/>

			<p id="separation-label">separation force: <span data-show="separation"></span></p>
			<input
				type="range"
				min="0"
				max="4"
				step="0.1"
				data-model="separation"
				aria-labelledby="separation-label"
			/>

			<p id="maxForce-label">steering force: <span data-show="maxForce"></span></p>
			<input
				type="range"
				min="0"
				max="1"
				step="0.05"
				data-model="maxForce"
				aria-labelledby="maxForce-label"
			/>

			<p id="minSpeed-label">min speed: <span data-show="minSpeed"></span></p>
			<input
				type="range"
				min="0"
				max="4"
				step="0.05"
				data-model="minSpeed"
				aria-labelledby="minSpeed-label"
			/>

			<p id="maxSpeed-label">max speed: <span data-show="maxSpeed"></span></p>
			<input
				type="range"
				min="0"
				max="12"
				step="0.25"
				data-model="maxSpeed"
				aria-labelledby="maxSpeed-label"
			/>

			<p id="drag-label">drag: <span data-show="drag"></span></p>
			<input
				type="range"
				min="0"
				max="0.05"
				step="0.001"
				data-model="drag"
				aria-labelledby="drag-label"
			/>

			<p id="noise-label">movement randomness: <span data-show="noise"></span></p>
			<input
				type="range"
				min="0"
				max="10"
				step="0.5"
				data-model="noise"
				aria-labelledby="noise-label"
			/>

			<h4>GGDP Optimizations</h4>
			<p class="info" style="font-size: 0.75rem; opacity: 0.7;">
				Toggle dimensional optimizations to see performance impact
			</p>

			<div class="ggdp-section">
				<div>
					<input type="checkbox" id="spatialHash" data-model="spatialHash" />
					<label for="spatialHash">
						spatial hash
						<span class="tooltip" role="tooltip">
							?
							<span class="tip">O(1) neighbor queries via grid partitioning. Disable for O(n²) baseline comparison.</span>
						</span>
					</label>
					<span class="ggdp-metric" data-metric="spatial"></span>
				</div>

				<div>
					<input type="checkbox" id="mortonOrder" data-model="mortonOrder" />
					<label for="mortonOrder">
						morton order
						<span class="tooltip" role="tooltip">
							?
							<span class="tip">Cache-coherent iteration via Z-order curves. Improves L1/L2 cache hits.</span>
						</span>
					</label>
					<span class="ggdp-metric" data-metric="morton"></span>
				</div>

				<div>
					<input type="checkbox" id="timeWheel" data-model="timeWheel" />
					<label for="timeWheel">
						time wheel
						<span class="tooltip" role="tooltip">
							?
							<span class="tip">Staggered updates: only 1/N boids get full physics each frame. Others interpolate.</span>
						</span>
					</label>
					<span class="ggdp-metric" data-metric="temporal"></span>
				</div>
				<div class="sub-control" id="timeWheel-opts">
					<p id="timeWheelSlots-label">slots: <span data-show="timeWheelSlots"></span></p>
					<input
						type="range"
						min="4"
						max="32"
						step="4"
						data-model="timeWheelSlots"
						aria-labelledby="timeWheelSlots-label"
					/>
				</div>

				<div>
					<input type="checkbox" id="hierarchicalTimeWheel" data-model="hierarchicalTimeWheel" />
					<label for="hierarchicalTimeWheel">
						hierarchical time
						<span class="tooltip" role="tooltip">
							?
							<span class="tip">Multi-level time wheel: active boids update fast, stationary boids update slow. Up to 128x capacity.</span>
						</span>
					</label>
					<span class="ggdp-metric" data-metric="hierarchical-temporal"></span>
				</div>
				<div class="sub-control" id="hierarchical-opts">
					<p id="activityThreshold-label">activity threshold: <span data-show="activityThreshold"></span></p>
					<input
						type="range"
						min="0.1"
						max="2"
						step="0.1"
						data-model="activityThreshold"
						aria-labelledby="activityThreshold-label"
					/>
				</div>

				<div>
					<input type="checkbox" id="geodesicPerception" data-model="geodesicPerception" />
					<label for="geodesicPerception">
						geodesic perception
						<span class="tooltip" role="tooltip">
							?
							<span class="tip">Blind spots: boids can't see directly behind them. More realistic flocking.</span>
						</span>
					</label>
					<span class="ggdp-metric" data-metric="perceptual"></span>
				</div>
				<div class="sub-control" id="geodesic-opts">
					<p id="blindSpotAngle-label">blind spot: <span data-show="blindSpotAngle"></span>°</p>
					<input
						type="range"
						min="0"
						max="180"
						step="15"
						data-model="blindSpotAngle"
						aria-labelledby="blindSpotAngle-label"
					/>
				</div>

				<div>
					<input type="checkbox" id="hyperbolicInfluence" data-model="hyperbolicInfluence" />
					<label for="hyperbolicInfluence">
						hyperbolic influence
						<span class="tooltip" role="tooltip">
							?
							<span class="tip">Sigmoid distance falloff: nearby neighbors matter much more than distant ones.</span>
						</span>
					</label>
					<span class="ggdp-metric" data-metric="influence"></span>
				</div>

				<div>
					<input type="checkbox" id="flowField" data-model="flowField" />
					<label for="flowField">
						flow field
						<span class="tooltip" role="tooltip">
							?
							<span class="tip">O(1) environmental forces (wind, thermals). Boids sample a force grid.</span>
						</span>
					</label>
					<span class="ggdp-metric" data-metric="flow"></span>
				</div>
				<div class="sub-control" id="flow-opts">
					<p id="flowStrength-label">strength: <span data-show="flowStrength"></span></p>
					<input
						type="range"
						min="0"
						max="1"
						step="0.05"
						data-model="flowStrength"
						aria-labelledby="flowStrength-label"
					/>
					<p id="windDirection-label">wind dir: <span data-show="windDirection"></span>°</p>
					<input
						type="range"
						min="0"
						max="360"
						step="15"
						data-model="windDirection"
						aria-labelledby="windDirection-label"
					/>
					<p id="windStrength-label">wind: <span data-show="windStrength"></span></p>
					<input
						type="range"
						min="0"
						max="1"
						step="0.05"
						data-model="windStrength"
						aria-labelledby="windStrength-label"
					/>
					<div>
						<input type="checkbox" id="turbulence" data-model="turbulence" />
						<label for="turbulence">turbulence</label>
					</div>
					<div>
						<input type="checkbox" id="showFlowField" data-model="showFlowField" />
						<label for="showFlowField">show flow field</label>
					</div>
				</div>

				<div>
					<input type="checkbox" id="visualFiber" data-model="visualFiber" />
					<label for="visualFiber">
						visual fiber
						<span class="tooltip" role="tooltip">
							?
							<span class="tip">Stress-based coloring: boids change color based on crowding, edges, and speed.</span>
						</span>
					</label>
					<span class="ggdp-metric" data-metric="visual"></span>
				</div>
			</div>

			<h4>debug info</h4>

			<input type="checkbox" id="debug" data-model="debug" />
			<label for="debug">show debug info</label>

			<div id="debug-opts" role="group" aria-label="Debug options">
				<p>fps: <span id="fps" aria-live="polite"></span></p>
				<p>neighbor checks: <span id="neighbor-checks" aria-live="polite">--</span></p>
				<p>physics: <span id="physics-time" aria-live="polite">--</span>ms</p>
				<div>
					<input type="checkbox" id="buckets" data-model="buckets" />
					<label for="buckets"> show spatial subdivision</label>
				</div>
			</div>
		</div>

		<div 
			id="toggler" 
			data-click="toggleMenu"
			role="button"
			aria-label="Toggle settings menu"
			tabindex="0"
		>
			<div class="img">
				<img src="./right-arrow.svg" alt="" aria-hidden="true" />
			</div>
		</div>

		<div 
			class="popupwindow" 
			id="popupwindow"
			role="dialog"
			aria-modal="true"
			aria-hidden="true"
		>
			<div class="popup" id="export-popup" role="document">
				<h3>export settings</h3>
				<textarea 
					id="exporter" 
					cols="30" 
					rows="10" 
					readonly
					aria-label="Exported settings"
				></textarea>
				<button data-click="copy">copy</button>
				<button data-click="leaveMenu" class="close">close</button>
			</div>

			<div class="popup" id="import-popup" role="document">
				<h3>import settings</h3>
				<textarea
					placeholder="paste your exported settings here..."
					id="importer"
					cols="30"
					rows="10"
					aria-label="Import settings input"
				></textarea>
				<button data-click="importSave">import</button>
				<button data-click="leaveMenu" class="close">close</button>
			</div>
		</div>

		<!-- ES Modules entry point - PIXI.js bundled via Vite -->
		<script type="module" src="./src/main.ts"></script>
	</body>
</html>
